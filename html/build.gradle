apply plugin: "java-library"
apply plugin: "org.docstr.gwt"
apply plugin: "war"

dependencies {
    implementation project(":core")
    api "com.badlogicgames.gdx:gdx-backend-gwt:$gdxVersion"
    api "com.badlogicgames.gdx:gdx:$gdxVersion:sources"
    api "com.badlogicgames.gdx:gdx-backend-gwt:$gdxVersion:sources"
    api "com.badlogicgames.gdx:gdx-box2d:$gdxVersion:sources"
    api "com.badlogicgames.gdx:gdx-box2d-gwt:$gdxVersion:sources"
}

gwt {
    gwtVersion = '2.8.2' // Downgraded to match libGDX compatibility
    maxHeapSize = "2G" // Increased for better compilation performance
    minHeapSize = "1G"

    src = files(project(":core").sourceSets.main.java.srcDirs, file("src/"))
    modules 'com.joust.GdxDefinition'
    devModules 'com.joust.GdxDefinitionSuperdev'
    project.webAppDirName = 'webapp'

    compiler {
        strict = true
        disableClassMetadata = true
        disableCastChecking = true
    }
}

// Simple dist task that compiles GWT and prepares the web deployment
task dist(dependsOn: [clean, compileGwt]) {
    doLast {
        file("build/dist/").mkdirs()
        copy {
            from "build/gwt/out/"
            into "build/dist/"
        }
        copy {
            from "webapp/"
            into "build/dist/"
        }
        copy {
            from "../assets/"
            into "build/dist/assets/"
            exclude '**/*.wav' // GWT doesn't support .wav files
        }
    }
}

task addSource {
    doLast {
        sourceSets.main.compileClasspath += files(project(':core').sourceSets.main.allJava.srcDirs)
    }
}

tasks.compileGwt.dependsOn(addSource)

sourceCompatibility = JavaVersion.VERSION_1_8
sourceSets.main.java.srcDirs = [ "src/", "../core/src" ]

eclipse.project.name = appName + "-html" 